<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
  <title>Test Portal ‚Äì Student</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body { background: linear-gradient(145deg, #f0f4ff 0%, #e6edfa 100%); min-height: 100vh; }
    .glass-card { background: rgba(255,255,255,0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 35px -10px rgba(0,0,0,0.1); }
    .lang-toggle { transition: all 0.2s; }
    /* 3-dot horizontal loader */
    .loader {
      display: flex; justify-content: center; align-items: center; gap: 8px;
    }
    .loader span {
      width: 12px; height: 12px; background-color: #3b82f6;
      border-radius: 50%; display: inline-block;
      animation: pulse 1.2s infinite ease-in-out;
    }
    .loader span:nth-child(2) { animation-delay: 0.2s; }
    .loader span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes pulse { 0%,80%,100% { transform: scale(0.6); opacity: 0.6; } 40% { transform: scale(1); opacity: 1; } }
    #globalLoader {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.3); backdrop-filter: blur(4px);
      display: flex; justify-content: center; align-items: center; z-index: 9999;
    }
  </style>
</head>
<body class="font-sans antialiased flex items-center justify-center p-4">
  <!-- Global Loader (hidden by default) -->
  <div id="globalLoader" class="hidden">
    <div class="loader"><span></span><span></span><span></span></div>
  </div>

  <div class="glass-card w-full max-w-md rounded-3xl p-8">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-700 bg-clip-text text-transparent" data-i18n="appTitle">üìò Test Portal</h1>
      <div class="flex space-x-2">
        <button onclick="setLanguage('en')" class="lang-toggle px-3 py-1 bg-white/80 text-blue-800 rounded-full text-sm font-medium shadow-sm hover:shadow">EN</button>
        <button onclick="setLanguage('hi')" class="lang-toggle px-3 py-1 bg-white/80 text-indigo-800 rounded-full text-sm font-medium shadow-sm hover:shadow">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
      </div>
    </div>
    
    <!-- Login Form -->
    <div id="loginForm" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="studentId">Student ID</label>
        <input type="text" id="studentId" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/70" placeholder="e.g. 2024CS001">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="dob">Date of Birth (DDMMYY)</label>
        <input type="text" id="dob" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/70" placeholder="010105" maxlength="6">
      </div>
      <button onclick="handleLogin()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-semibold py-3 px-4 rounded-xl transition duration-200 flex items-center justify-center gap-2 shadow-lg">
        <i class="fas fa-sign-in-alt"></i> <span data-i18n="login">Login</span>
      </button>
      <div class="text-center text-sm text-gray-600">
        <span data-i18n="noAccount">Don't have an account?</span>
        <a href="#" onclick="showRegister()" class="text-blue-600 hover:underline font-medium" data-i18n="registerHere">Register here</a>
      </div>
    </div>
    
    <!-- Register Form -->
    <div id="registerForm" class="space-y-4 hidden">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="fullName">Full Name</label>
        <input type="text" id="regName" class="w-full px-4 py-3 border border-gray-200 rounded-xl bg-white/70">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="studentId">Student ID</label>
        <input type="text" id="regId" class="w-full px-4 py-3 border border-gray-200 rounded-xl bg-white/70">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="dob">Date of Birth (DDMMYY)</label>
        <input type="text" id="regDob" class="w-full px-4 py-3 border border-gray-200 rounded-xl bg-white/70" maxlength="6">
      </div>
      <button onclick="handleRegister()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-4 rounded-xl transition shadow-lg">
        <i class="fas fa-user-plus"></i> <span data-i18n="register">Register</span>
      </button>
      <div class="text-center text-sm">
        <a href="#" onclick="showLogin()" class="text-gray-600 hover:underline" data-i18n="backToLogin">‚Üê Back to login</a>
      </div>
    </div>
    
    <div id="message" class="mt-4 text-sm text-center hidden p-3 rounded-xl"></div>
  </div>

  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz4REt1W-ub1jd1uMz-uD-Rth3rTXo5ALuZFSVz1qXph9zu1XevbMgTCphCTTOhShDcqA/exec';
    const translations = {
      en: { appTitle: 'üìò Test Portal', studentId: 'Student ID', dob: 'Date of Birth (DDMMYY)', login: 'Login', noAccount: "Don't have an account?", registerHere: 'Register here', fullName: 'Full Name', register: 'Register', backToLogin: '‚Üê Back to login' },
      hi: { appTitle: 'üìò ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤', studentId: '‡§õ‡§æ‡§§‡•ç‡§∞ ‡§Ü‡§à‡§°‡•Ä', dob: '‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø (DDMMYY)', login: '‡§≤‡•â‡§ó ‡§á‡§®', noAccount: '‡§ñ‡§æ‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à?', registerHere: '‡§Ø‡§π‡§æ‡§Å ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç', fullName: '‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ', register: '‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£', backToLogin: '‚Üê ‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Å' }
    };
    let currentLang = 'en';
    function setLanguage(lang) {
      currentLang = lang;
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (translations[lang]?.[key]) {
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = translations[lang][key];
          else el.innerText = translations[lang][key];
        }
      });
    }
    window.onload = () => setLanguage('en');

    function showLoader() { document.getElementById('globalLoader').classList.remove('hidden'); }
    function hideLoader() { document.getElementById('globalLoader').classList.add('hidden'); }

    async function fetchAPI(body) {
      showLoader();
      try {
        const res = await fetch(APPS_SCRIPT_URL, { method: 'POST', body: JSON.stringify(body) });
        const data = await res.json();
        return data;
      } finally { hideLoader(); }
    }

    function showRegister() { document.getElementById('loginForm').classList.add('hidden'); document.getElementById('registerForm').classList.remove('hidden'); }
    function showLogin() { document.getElementById('registerForm').classList.add('hidden'); document.getElementById('loginForm').classList.remove('hidden'); }
    function showMessage(msg, isError = false) {
      const msgDiv = document.getElementById('message');
      msgDiv.classList.remove('hidden');
      msgDiv.className = `mt-4 text-sm text-center p-3 rounded-xl ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;
      msgDiv.innerText = msg;
      setTimeout(() => msgDiv.classList.add('hidden'), 4000);
    }

    async function handleLogin() {
      const id = document.getElementById('studentId').value.trim();
      const dob = document.getElementById('dob').value.trim();
      if (!id || !dob) return showMessage('Fill all fields', true);
      const data = await fetchAPI({ action: 'login', id, dob });
      if (data.status === 'success') {
        localStorage.setItem('token', data.token);
        localStorage.setItem('studentName', data.data.name);
        localStorage.setItem('studentId', id);
        window.location.href = 'test.html';
      } else showMessage(data.data, true);
    }

    async function handleRegister() {
      const name = document.getElementById('regName').value.trim();
      const id = document.getElementById('regId').value.trim();
      const dob = document.getElementById('regDob').value.trim();
      if (!name || !id || !dob) return showMessage('Fill all fields', true);
      const data = await fetchAPI({ action: 'register', id, name, dob });
      if (data.status === 'success') { showMessage('Registration successful! Please login.'); showLogin(); }
      else showMessage(data.data, true);
    }
  </script>
</body>
</html>
